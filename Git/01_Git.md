## Git

Git 是一个版本管理工具，并且支持多人协同工作。这句话可能有点抽象，需要对“版本管理”和“多人协同”进行解释。

先说说版本管理。当不使用版本管理工具时，我们修改代码时，如果要保留旧版本，要么把旧代码注释起来，要么进行复制粘贴，十分麻烦。使用 Git 这种版本管理工具以后，就可以追踪版本的变化，并将旧的版本保存起来。当我们需要回退版本时，直接输入对应的命令就可以了。

再说多人协同。Git 可以生成多个分支，可以将文件保存到不停的分支里，那么就可以给多个人分配对应的分支，每个人在他的分支里编写代码即可。编写完成后，Git 还支持分支合并，这样就完成了一次多人协同工作。



下载好 Git 以后，我们会获得 `Git Bash`和 `Git CMD`等，我们主要使用 Git Bash，这个终端使用 Linux 指令，可以执行 Git 命令。



### 一、Git & SVN

有很多版本管理工具，最常用的就是 Git 和 SVN，这一节我们将它们进行对比。

SVN是Subversion的简称，是一个开放源代码的版本控制系统,支持大多数常见的操作系统。作为一个开源的版本控制系统，Subversion管理着随时间改变的数据。这些数据放置在一个中央资料档案库(repository)中。这个档案库很像一个普通的**文件服务器**,不过它会记住每一次文件的变动。这样你就可以把档案恢复到旧的版本,或是浏览文件的变动历史。Subversion是一个通用的系统,可用来管理任何类型的文件,其中包括了程序源码。
所以说，SVN 是集中式的，代码必须集中到中央服务器，版本库只存在于服务器中。

Git是一个开源的分布式版本控制系统，用以有效、高速的处理从很小到非常大的项目版本管理。Git 是 Linus Torvalds 为了帮助管理 Linux 内核开发而开发的一个开放源码的版本控制软件。

分布式相比于集中式的最大区别在于开发者可以提交到本地，每个开发者通过克隆（git clone），在本地机器上拷贝一个完整的Git仓库。也就是说 Git 拥有本地仓库，可以不与服务器连接完成版本管理操作。

总的来说：

1. SVN属于集中化的版本控制系统，有个不太精确的比喻:SVN = 版本控制+ 备份服务器。

   SVN使用起来有点像是档案仓库的感觉，支持并行读写文件，支持代码的版本化管理，功能包括取出、导入、更新、分支、改名、还原、合并等。

2. GIT跟SVN一样有自己的集中式版本库或服务器。但，GIT更倾向于被使用于分布式模式，也就是每个开发人员从中心版本库/服务器上check out代码后会在自己的机器上克隆一个自己的版本库。可以这样说，如果你被困在一个不能连接网络的地方时，就像在飞机上，地下室，电梯里等，你仍然能够提交文件，查看历史版本记录，创建项目分支等。对一些人来说，这好像没多大用处，但当你突然遇到没有网络的环境时，这个将解决你的大麻烦。



### 二、Git 的配置

#### 1. 查看配置

我们可以先查看一下 Git 的所有配置，打开 Git Bash，输入指令：

```shell
git config -l
```

即可查看 Git 的所有配置。

Git 也提供了查看配置的过滤方法，比如查看系统配置：

```shell
git config --system --list
```

查看用户的全局配置：

```shell
git config --global --list
```

有很多查看配置的方法，我们输入 `git config` 即可打印出方法列表，部分列表如下，我们可以选择里面的方法：

```shell
Config file location
    --global              use global config file
    --system              use system config file
    --local               use repository config file
    --worktree            use per-worktree config file
    -f, --file <file>     use given config file
    --blob <blob-id>      read config from given blob object
```

这些配置都保存在本地文件里，具体文件的路径可以上网查找文档。

#### 2. 编写配置

我们知道，所谓的终端命令，其实就是对文件读写的封装。当我们在 `Git Bash` 中写配置时，其实就是在使用封装好的函数进行文件读写。

当要创建用户时，需要输入以下命令：

```shell
git config --global user.name "HongyuChen"
git config --global user.email "2314727037@qq.com"
```

输入以上命令即可创建用户，我们可以分析以下代码：

`git config` 告诉终端我们调用的是配置相关的函数，`--globel` 表示是全局配置，`user` 为对象名，`name` 和 `email` 是对象的属性。

所以 Git 的命令**本质就是文件读写的封装函数**，理解以后不需要怎么记忆就能熟练运用，只需要对 Git 的大体框架熟悉即可。



### 三、Git 基本理论框架

#### 1. Git 的工作区

Git 本地有三个工作区域：工作目录(working directory)、暂存区(stage)、本地仓库(history)，还有一个远程仓库(remote directory)。

- 工作目录也就是文件夹内的文件，可以直接编写；
- 暂存区存放了已经修改好的文件的列表，并没有存放文件；
- 本地仓库用于保存所有的版本；远程仓库和本地仓库一样，保存所有的历史版本，并且可以和本地资源库进行交互。

#### 2. Git 的工作流程

Git 的一般工作流程如下：

1. 在工作目录中添加、修改文件
2. 将需要进行版本管理的文件添加到暂存区(git add)
3. 将暂存区中的文件提交到本地仓库(git commit)
4. 将本地仓库的文件上传到远程仓库(git push)

当然，也可以反过来操作：

1. 将远程仓库拉回到本地仓库(git pull)
2. 将本地仓库中的历史版本覆盖暂存区，即进行版本回退(git reset)
3. 将暂存区中的文件退还给工作区(git checkout)



所以Git 管理的文件有五种状态：未跟踪(untracked)，已暂存(staged)，已提交(committed)，已修改(modified)。

- untracked：未跟踪，文件在本地仓库的根目录下，但是并没有加入 git 库，即未进行 `git add` 命令
- staged：已跟踪，针对的就是已经登记在案的文件最近又发生了改动的情况，也就是说我们最近改过了某一个之前已经登记在案的文件，那么当我们查看状态的时候得到的就是modified，表示改动了，之前的记录已经不是最新的了，我们需要更新。
- committed：被跟踪的文件已提交到仓库中。
- modified：文件已经加入到 git 仓库，且已经被修改。



### 四、本地仓库搭建

可以本地新建仓库，也可以直接从远程克隆

#### 1. 本地创建新的仓库

创建全新的仓库，需要将目录所引到当前文件夹(项目的根目录)，并输入命令：

```shell
git init
```

执行该命令后，该目录下会出现一个 `.git` 目录，该文件夹用于存放版本管理的信息。

#### 2. 从远程仓库克隆

```shell
git clone 仓库url
```



### 五、Git 文件操作命令

#### 1. 文件提交到仓库

我们可以使用 `git status` 命令查看 git 仓库中各文件的状态：

```shell
git status # 查看所有文件状态
git status 文件名 # 查看指定文件状态
```

初始化仓库以后，我们使用以下命令提交项目文件：

```shell
git add 文件名
git add . # 添加所有文件到暂存区
git commit -m "提交信息"
```

输入以上命令后，就可以将文件提交到仓库了。

#### 2. 忽略某些文件

有的时候我们不想将某些文件纳入版本控制中，可以在仓库目录下建立 `.gitignore` 文件，该文件有如下规则：

1. 注释为 `#` ，和 python 一样
2. 可以使用 Linux 通配符：
3. 名称前的感叹号 `!` 表示例外，不被忽略
4. 名称前是一个斜杠 `/` 表示忽略根目录下的该文件
5. 名称后是一个斜杠 `/` 表示忽略根目录下该文件夹

```shell
*.txt	# 忽略所有txt
!lib.txt	# lib.txt除外
/temp	# 忽略根目录下的 temp 文件
build/	# 忽略根目录下的build文件夹
```



### 六、使用 Git hub

#### 1. 配置 SSH

注册完以后，设置一个 SSH 公钥，实现免密码登录。

首先，在 Git Bash 中检查本地是否已经配置了 SSH：

```shell
ls -al ~/.ssh
```

如果显示无配置，则生成密钥对：

```shell
 ssh-keygen -t rsa -b 4096 -C "2314727037@qq.com"
```

一路回车即可，生成密钥对以后，再查看一下 SSH：

```shell
ls -al ~/.ssh
```

可以看到密钥对的信息，然后输入以下命令查看具体的公钥内容(带有.pub后缀的是公钥，没有后缀的是私钥)：

```shell
cat ~/.ssh/id_rsa.pub
```

将打印出的内容复制，粘贴到 Git hub 的公钥里(title 可以写一些相关信息)。

输入以下命令，测试ssh连通性，有如下successfully即成功了：

```shell
ssh -T git@github.com
```

配置好 SSH 以后，就可以使用 SSH 而不是 HTTP 进行仓库的上传下载了。

#### 2. 项目上传和下载

在 Git hub 上新建一个仓库，并克隆到本地(git clone)，然后将项目文件夹移动到克隆下来的文件根目录下，再进行添加、提交、push即可。也可以添加 .gitignore 文件。

**注意：添加、提交等步骤只需要在项目文件夹的目录下进行即可**



### 七、Git 分支

分支就是在主枝干(main or master) 上新开一个仓库，这些分支互仓库相不影响。

分支在实际中有什么用呢？假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。

现在有了分支，就不用怕了。你创建了一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。



我们可以通过以下命令查看分支：

```shell
git branch	# 查看本地分支
git branch -r	# 查看远程分支
```

可以使用以下命令新建分支：

```shell
git branch 分支名字
```

切换分支：

```shell
git checkout 分支名字
```

合并指定分支到当前分支：

```shell
git merge 分支名字
```

删除分支：

```shell
git branch -d 分支名字
```



### 八、版本控制

#### 1. 版本移动

我们可以使用以下命令查看版本的历史记录：

```shell
git log	# 详细信息
git reflog	# 简略信息
```

可以使用以下命令回退到之前的版本：

```shell
git reset –hard HEAD ^	# 回到上一个版本
git reset –hard HEAD~2	# 回到前两个版本
git reset –hard 版本号	  # 回到指定的版本（版本号可以用git (ref)log 查看）
```

回退以后如果还想恢复，也可以使用 `git reset -hard 版本号` 移动到对应版本。

#### 2. 打标签

玩过很多游戏，更新时都会附带版本号，git 也支持给不同的版本赋予版本号，也就是打标签：

```shell
git tag -a 版本号 -m "标签信息"	# 附注标签，这种标签信息很全
git tag 版本号		# 轻型标签，这种标签信息量较少
```

**注意：打的标签只能对应上一次提交的版本**

我们可以使用以下命令查看标签：

```shell
git tag		# 列出已有标签
git show	# 列出标签和对应版本的信息
```

如果有一次提交忘了打标签，可以补上：

```shell
git tag -a 标签名 版本号
```

这里的版本号可以用 `git reflog` 查阅。

默认情况下，git push并不会把tag标签传送到远端服务器上，只有通过显式命令才能分享标签到远端仓库。

1. push单个tag，命令格式为：`git push origin [tagname]`
   例如：
   `git push origin v1.0` 将本地v1.0的tag推送到远端服务器
2. push所有tag，命令格式为：`git push [origin] --tags`
   例如：
   `git push --tags`
   或
   `git push origin --tags`

以上命令经检验通过，如果不起作用，请在Git控制台上确认你的账号是否有权限推送Tag。

### 九、发布版本

git hub 提供了发布不同版本的功能：release。我们在仓库点击 release，把对应的版本号 (tag) 填好即可发布。并且 git hub 提供了 api 来下载我们发布的版本。
