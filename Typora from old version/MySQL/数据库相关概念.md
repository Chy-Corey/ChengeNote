# MySql

## 一、 基础知识

### 1. 数据库相关概念

- DB

  数据库(database)：存储数据的仓库，保存了一系列有组织的数据

- DBMS

  数据库管理系统(Database Management System)：数据库通过DBMS创建和操作的容器。简单来说，就是通过DBMS来操作DB

  常见的数据库管理系统：MySQL、Oracle、DB2、SqlServer

- SQL

  结构化查询语言(Structure Query Language)：专门用来与数据库通信的语言

### 2. 数据库存储数据的特点

1. 将数据放到表中，，表再放到库中
2. 一个数据库中可以有多个表，每个表都有一个名字用来标识自己，表名具有唯一性
3. 表具有一些特性，这些特性规定了数据在表中如何存储，类似java中class的设计
4. 表由列组成，也称为字段，所有表都是由一个或多个列组成的，每一列类似java的key(属性)
5. 表中的数据是按行存储的，每一行类似于java的一个对象

### 3. MySql 安装

[MySQL的详细安装教程 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/188416607)

### 4. MySql 启动和停止

#### 方法一

右键我的电脑 -> 管理 ->服务和应用程序 -> 服务 -> 找到自己的Sql服务 -> 进行启动和关闭操作

**可以在服务界面选择开机自启或者手动启动**

#### 方法二

以管理员身份打开cmd -> 输入命令：net start/stop "服务名"

### 5. 登录MySql

```mysql
mysql -u"用户名" -p"密码"
// 规定IP和端口
mysql -u"用户名" -p"密码" -h"ip" -P"端口"
```

显示welcome则登陆成功

### 6. 常用命令

- 退出MySql： exit
- 查看数据库： show databases;
- 选择数据库： use "name";
- 创建数据库： create database "name";

## 二、 表的理解和使用

### 1. 概念 

数据库当中是以表格的形式展示数据的，任何一张表都有行和列：

​	行(row)：每一行是表中的一个数据

​	列(column)：每一列是一个字段，比如姓名字段、性别字段、年龄字段。每个字段都有字段名、数据类型、约束等属性。

### 2. SQL语句分类

1. DQL

   数据查询语言（带有select关键字）

2. DML

   数据操作语言（对表中数据的增删改）

   insert delete update

3. DDL

   数据定义语言

   凡是带有create、drop、alter的都是DDL。DDL操作的是表的结构，而不是数据。

4. TCL

   事务控制语言

   事务提交：commit		事务回滚： rollback

5. DCL

   数据控制语言

   例如：授权grant、撤销权限revoke   ....

### 3. DQL 简单查询

#### 3.1. 查询一个字段

```mysql
select 字段名 from 表名
```

注意： select 和 from 都是关键字，字段名和表名都是标识符

强调： 所有SQL语句以分号结尾，并且SQL不区分大小写

#### 3.2. 查询多个字段

只要使用逗号隔开就行

```mysql
select 字段名1,字段名2 from 表名
```

#### 3.3. 查询所有字段

使用通配符 * 即可

```mysql
select * from 表名
```

不过这种方法效率比较低，实际开发时最后还是一五一十地把所有字段都写出来。

#### 3.4. 列起别名

```mysql
select 列名 as 别名 from 表名
```

**注意**：此处的修改的别名只是在显示的时候表现出来，实际上没有修改

如果起的别名中间有空格或者中文，需要把别名用引号（最好是单引号）包起来

#### 3.5. 列的运算

字段可以使用数学表达式

```mysql
select 列名*10 from 表名
```

### 4. 条件查询 & 排序

#### 条件查询

```mysql
select 字段1,字段2,字段3...
from 表名
where 条件;
```

|        符号         |                      功能                       |
| :-----------------: | :---------------------------------------------: |
|        =/!=         |                   等于/不等于                   |
|      </<=/>/>=      |           小于/小于等于/大于/大于等于           |
|  between...and...   |                   在两值之间                    |
| is null/is not null |                   没有值/有值                   |
|       and/or        |                      与/或                      |
|      in/not in      |               包含，相当于多个or                |
|        like         | 模糊查询，支持%或_匹配 %任意多个,下划线任意一个 |

**注意**：模糊查询，正则表达式要加引号，转义字符为\，可以用转义字符把下划线转义为单纯的下划线

### 5. 排序

```mysql
select 
	字段名1,字段名2, ...
from
	表名
order by// 默认升序 
	字段名;
```

#### 5.1. 多个字段排序

```mysql
select
	字段1,字段2
from 
	表名
order by 
	字段1 asc, 字段2 asc;// 在前面的起主导，只有在前面的相等时，才考虑用后面的排序
```

**升序为asc，降序为desc**

## 三、 单行处理函数

单行处理函数特点：一个输入对应一个输出

多行处理函数特点：多个输入对应一个输出

|      函数       |          功能          |
| :-------------: | :--------------------: |
| lower()/upper() |    转换为小写/大写     |
|     substr      |         取子串         |
|     length      |         取长度         |
|      trim       |         去空格         |
|   str_to_date   |   将字符串转换为日期   |
|   date_format   |       格式化日期       |
|      round      |        四舍五入        |
|     rand()      |       生成随机数       |
|     ifnull      | 将null转换为一个具体值 |

|                |                      |
| :------------: | :------------------: |
|     concat     |         合并         |
|     format     |      设置千分位      |
| case when then | 根据字段的字面量匹配 |

## 四、 分组函数 & 分组查询

### 分组函数

| 函数  |  功能  |
| :---: | :----: |
| count |  计数  |
|  sum  |  求和  |
|  avg  | 平均值 |
|  max  | 最大值 |
|  min  | 最小值 |

**注意：**分组函数使用时必须先分组，后查询。如果没有分组，整张表默认为一组。

- 分组函数会自动忽略null，不需要对null进行处理

- 分组函数中，`count(*)`和`count(字段)` 的区别

  ​		字段：这一字段下不为null的数量

  ​		*：只要有一行数据，就不可能全都是null，所以统计了表中的总行数。

- 分组函数不能直接使用在where子句中

### 分组查询★★★★★

在实际应用中，可能有这样的需求，需要先进行分组，然后对每一组的数据进行操作，这个时候使用分组查询。

```mysql
select 
	...
from
	...
group  y
	...;
```

##### 关键字的书写顺序和执行顺序

```mysql
-- 书写顺序
select from where group by order by
-- 执行顺序
from where group by select order by
```

### 另一个关键字

distinct 字段： 去重

## 五、 连接查询

从一张表中单独查询，称为单表查询。多个表联合起来查询数据，这种跨表查询，多张表联合起来查询数据，被称为连接查询。

### 1. 连接查询的分类

根据表连接方式的分类：

- 内连接
  - 等值连接
  - 非等值连接
  - 自连接
- 外连接
  - 左连接
  - 右连接

### 2. 笛卡尔积

当两张表连接查询时，如果没有任何限制，会出现笛卡尔积现象

`笛卡尔积` 又叫cross join，是SQL中两表连接的一种方式。 假如A表中的数据为m行，B表中的数据有n行，那么A和B做笛卡尔积，结果为m*n行。 通常我们都要在实际SQL中避免直接使用笛卡尔积，因为它会使“数据爆炸”，尤其是数据量很大的时候。 但某些时候，巧妙的使用笛卡尔积，反而能快速帮助我们解决实际问题。

#### 2.1. 避免笛卡尔积

为了避免笛卡尔积，需要添加匹配条件，当然这样不会减少搜索匹配次数。

为了减少匹配次数，增加效率，可以添加表名前缀

```mysql
select
	e.ename, d.dname
from
	emp e, dept d 	-- 给表起别名
where
	e.deptno = d.deptno;
```

### 3. 内连接查询 

#### 3.1. 等值查询

